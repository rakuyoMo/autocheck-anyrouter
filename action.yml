name: 'Auto Checkin AnyRouter'
description: 'AnyRouter è‡ªåŠ¨ç­¾åˆ°æœåŠ¡ï¼Œæ”¯æŒå¤šç§é€šçŸ¥æ–¹å¼å’Œè‡ªå®šä¹‰é…ç½®'
author: 'rakuyo'

branding:
  icon: 'check-circle'
  color: 'green'

inputs:
  accounts:
    description: 'AnyRouter è´¦å·ä¿¡æ¯'
    required: true
  show-sensitive-info:
    description: 'æ˜¯å¦æ˜¾ç¤ºæ•æ„Ÿä¿¡æ¯'
    required: false
    default: false
  dingtalk-notif-config:
    description: 'é’‰é’‰é€šçŸ¥é…ç½®'
    required: false
  email-notif-config:
    description: 'é‚®ä»¶é€šçŸ¥é…ç½®'
    required: false
  pushplus-notif-config:
    description: 'PushPlus é€šçŸ¥é…ç½®'
    required: false
  serverpush-notif-config:
    description: 'Serveré…±é€šçŸ¥é…ç½®'
    required: false
  feishu-notif-config:
    description: 'é£ä¹¦é€šçŸ¥é…ç½®'
    required: false
  wecom-notif-config:
    description: 'ä¼ä¸šå¾®ä¿¡é€šçŸ¥é…ç½®'
    required: false
  bark-notif-config:
    description: 'Bark é€šçŸ¥é…ç½®'
    required: false
  telegram-notif-config:
    description: 'Telegram é€šçŸ¥é…ç½®'
    required: false

runs:
  using: 'composite'
  steps:
    - name: ğŸ”§ å®‰è£… Mise
      uses: jdx/mise-action@v3
      with:
        cache_key: "{{default}}-${{ hashFiles('pyproject.toml') }}"

    - name: âš™ï¸ å®‰è£…ä¾èµ–
      shell: bash
      run: mise run install

    - name: ğŸ­ é…ç½® Playwright ç¯å¢ƒ
      uses: ./.github/actions/setup-playwright
      id: playwright-setup

    - name: ğŸ’¾ æ¢å¤ä½™é¢å†å²ç¼“å­˜
      uses: actions/cache@v4
      with:
        path: balance_hash.txt
        key: balance-hash-${{ github.run_id }}
        restore-keys: |
          balance-hash-

    - name: ğŸš€ æ‰§è¡Œç­¾åˆ°ä»»åŠ¡
      shell: bash
      env:
        # ä»“åº“å¯è§æ€§ï¼Œç”¨äºéšç§æ§åˆ¶
        REPO_VISIBILITY: ${{ github.event.repository.visibility }}
        # è´¦å·é…ç½®
        ANYROUTER_ACCOUNTS: ${{ inputs.accounts }}
        # æ˜¯å¦æ˜¾ç¤ºè„±æ•ä¿¡æ¯
        SHOW_SENSITIVE_INFO: ${{ inputs.show-sensitive-info }}
        # é€šçŸ¥é…ç½®
        DINGTALK_NOTIF_CONFIG: ${{ inputs.dingtalk-notif-config }}
        EMAIL_NOTIF_CONFIG: ${{ inputs.email-notif-config }}
        PUSHPLUS_NOTIF_CONFIG: ${{ inputs.pushplus-notif-config }}
        SERVERPUSH_NOTIF_CONFIG: ${{ inputs.serverpush-notif-config }}
        FEISHU_NOTIF_CONFIG: ${{ inputs.feishu-notif-config }}
        WECOM_NOTIF_CONFIG: ${{ inputs.wecom-notif-config }}
        BARK_NOTIF_CONFIG: ${{ inputs.bark-notif-config }}
        TELEGRAM_NOTIF_CONFIG: ${{ inputs.telegram-notif-config }}
      run: mise run checkin
